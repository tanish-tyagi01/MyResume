Basic Analysis

1. Retrieve the total number of orders placed.
    SELECT COUNT(DISTINCT order_id) FROM orders;

2. Calculate the total revenue generated from pizza sales.
    SELECT SUM(OD.quantity * P.price)
    FROM order_details AS OD
    JOIN pizzas AS P ON OD.pizza_id = P.pizza_id;

3. Identify the highest-priced pizza.
    SELECT PT.name, P.size, P.price
    FROM pizzas AS P
    JOIN pizza_types AS PT ON P.pizza_type_id = PT.pizza_type_id
    ORDER BY P.price DESC
    LIMIT 1;

4. Identify the most common pizza size ordered.
    SELECT P.size, SUM(OD.quantity) AS total_quantity
    FROM order_details AS OD
    JOIN pizzas AS P ON OD.pizza_id = P.pizza_id
    GROUP BY P.size
    ORDER BY total_quantity DESC
    LIMIT 1;

5. List the top 5 most ordered pizza types along with their quantities.
    SELECT PT.name, SUM(OD.quantity) AS total_quantity
    FROM order_details AS OD
    JOIN pizzas AS P ON OD.pizza_id = P.pizza_id
    JOIN pizza_types AS PT ON P.pizza_type_id = PT.pizza_type_id
    GROUP BY PT.name
    ORDER BY total_quantity DESC
    LIMIT 5;

Intermediate Analysis

6. Join the necessary tables to find the total quantity of each pizza category ordered.
    SELECT PT.category, SUM(OD.quantity) AS total_quantity
    FROM order_details AS OD
    JOIN pizzas AS P ON OD.pizza_id = P.pizza_id
    JOIN pizza_types AS PT ON P.pizza_type_id = PT.pizza_type_id
    GROUP BY PT.category
    ORDER BY total_quantity DESC;

7. Determine the distribution of orders by hour of the day.
    SELECT STRFTIME('%H', O.time) AS order_hour, COUNT(DISTINCT O.order_id) AS total_orders
    FROM orders AS O
    GROUP BY order_hour
    ORDER BY total_orders DESC;

8. Join relevant tables to find the category-wise distribution of pizzas.
    SELECT AVG(daily_pizzas)
    FROM (
        SELECT O.date, SUM(OD.quantity) AS daily_pizzas
        FROM orders AS O
        JOIN order_details AS OD ON O.order_id = OD.order_id
        GROUP BY O.date
    );

9. Determine the top 3 most ordered pizza types based on revenue.
    SELECT PT.name, SUM(OD.quantity * P.price) AS total_revenue
    FROM order_details AS OD
    JOIN pizzas AS P ON OD.pizza_id = P.pizza_id
    JOIN pizza_types AS PT ON P.pizza_type_id = PT.pizza_type_id
    GROUP BY PT.name
    ORDER BY total_revenue DESC
    LIMIT 3;

Advance Analysis

10. Calculate the percentage contribution of each pizza type to total revenue.
    WITH TotalRevenue AS (
        SELECT SUM(OD.quantity * P.price) AS total_rev
        FROM order_details AS OD
        JOIN pizzas AS P ON OD.pizza_id = P.pizza_id
    )
    SELECT PT.name, (SUM(OD.quantity * P.price) * 100.0 / TR.total_rev) AS percentage_contribution
    FROM order_details AS OD
    JOIN pizzas AS P ON OD.pizza_id = P.pizza_id
    JOIN pizza_types AS PT ON P.pizza_type_id = PT.pizza_type_id
    CROSS JOIN TotalRevenue AS TR
    GROUP BY PT.name
    ORDER BY percentage_contribution DESC;

11. Analyze the cumulative revenue generated over time.
    WITH DailyRevenue AS (
        SELECT O.date, SUM(OD.quantity * P.price) AS daily_rev
        FROM orders AS O
        JOIN order_details AS OD ON O.order_id = OD.order_id
        JOIN pizzas AS P ON OD.pizza_id = P.pizza_id
        GROUP BY O.date
        ORDER BY O.date ASC
    )
    SELECT date, SUM(daily_rev) OVER (ORDER BY date) AS cumulative_revenue
    FROM DailyRevenue;

12. Determine the top 3 most ordered pizza types based on revenue for each pizza category.
    WITH PizzaRevenue AS (
        SELECT
            PT.category,
            PT.name,
            SUM(OD.quantity * P.price) AS total_revenue
        FROM order_details AS OD
        JOIN pizzas AS P ON OD.pizza_id = P.pizza_id
        JOIN pizza_types AS PT ON P.pizza_type_id = PT.pizza_type_id
        GROUP BY PT.category, PT.name
    ),
    RankedRevenue AS (
        SELECT
            category,
            name,
            total_revenue,
            -- Use RANK() or DENSE_RANK() to assign a rank within each category
            ROW_NUMBER() OVER (PARTITION BY category ORDER BY total_revenue DESC) AS rank_num
        FROM PizzaRevenue
    )
    SELECT category, name, total_revenue
    FROM RankedRevenue
    WHERE rank_num <= 3
    ORDER BY category, total_revenue DESC;


